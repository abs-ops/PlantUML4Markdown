apply plugin: 'java'

defaultTasks 'compilePlantuml'

task wrapper(type: Wrapper) {
    gradleVersion = '1.4'
}

repositories {
  mavenCentral()
  mavenLocal()
}

dependencies {
  compile "net.sourceforge.plantuml:plantuml:7959",
          "org.jruby:jruby-complete:1.7.3"
}

task cloneDocuments(type: Copy) {
  from 'Documents'
  into "$buildDir/Documents"
}

task cloneStrapdown(type: Copy) {
  from 'Tools/strapdown'
  into "$buildDir/Documents/strapdown"
}

task compileMarkdown(type: JavaExec, dependsOn: [cloneDocuments, cloneStrapdown]) {
  classpath = configurations.compile
  main = "org.jruby.Main"
  jvmArgs "-Dfile.encoding=UTF-8"
  args "-Ku", "Tools/plantuml4markdown.rb", "$buildDir/Documents"
}

task compilePlantuml(type: JavaExec, dependsOn: [compileMarkdown]) {
  classpath = configurations.compile
  main = "net.sourceforge.plantuml.Run"
  args "-tsvg", "$buildDir/Documents/**/*.plantuml"
}
